TestScheduler необходим для визуализации поведения Observable. Мы можем использовать **Marble diagrams**, чтобы утверждать, что конкретная наблюдаемая величина ведет себя так, как ожидалось, с помощью создания горячих и холодных Observable.

```typescript
const testScheduler = new TestScheduler((actual, expected) => {
// Требуется указать способ сравнения объктов
expect(actual).deep.equal(expected);
});

it('generates the stream correctly', () => {
	testScheduler.run((helpers) => {
		const { cold, time, expectObservable, expectSubscriptions } = helpers;
		const e1 = cold(' -a--b--c---|');
		const e1subs = ' ^----------!';
		const t = time(' ---| '); // t = 3const expected = '-a-----c---|';
		expectObservable(e1.pipe(throttleTime(t))).toBe(expected);
		expectSubscriptions(e1.subscriptions).toBe(e1subs);
});
});
```

В `testScheduler` на вход идёт объект helpers:
```typescript
testScheduler.run((helpers) => {
  const { cold, hot, expectObservable, expectSubscriptions, flush, time, animate } = helpers;
});
```

cold - создает "холодный" Observable, подписка на который запускается при запуске теста.
hot - создает "горячий" Observable (к примеру Subject), который будет вести себя так, как будто он уже "запущен", когда начнется тест

В контексте TestScheduler диаграмма marble - это строка, содержащая специальный синтаксис, представляющий события, происходящие в течение виртуального времени. Время прогрессирует по кадрам. Первый символ любой строки marble всегда представляет нулевой кадр или начало времени. Внутри TestScheduler.run(обратный вызов) frameTimeFactor установлен равным 1, что означает, что один кадр равен одной виртуальной миллисекунде.

Сколько виртуальных миллисекунд представляет один кадр, зависит от значения TestScheduler.frameTimeFactor. По устаревшим причинам значение frameTimeFactor равно 1 только тогда, когда выполняется ваш код внутри обратного вызова TestScheduler.run(callback). За пределами этого значения оно равно 10. Это, вероятно, изменится в будущей версии RxJS, так что оно всегда будет равно 1.

# Синтаксис marbles
* *' ' пробел: горизонтальный пробел игнорируется и может использоваться для выравнивания нескольких мраморных диаграмм по вертикали. (для красоты кароче)
* *'-' кадр: 1 "кадр" прохождения виртуального времени (см. описание кадров выше).
* *[0-9]+[ms|s|m] прогрессия по времени: синтаксис прогрессии по времени позволяет увеличить виртуальное время на определенную величину. Это число, за которым следует единица измерения времени в ms (миллисекунды), s (секунды) или m (минуты) без пробелов между ними, например, `a 10ms b`. 
* *'|' complete: Успешное завершение наблюдаемого объекта. Это сигнализация observable о завершении.
* Ошибка '#': Ошибка наблюдаемого объекта.
* *[a-z0-9] например, 'a' любой буквенно-цифровой символ: Представляет значение, передаваемое производителем, сигнализирующим next(). Также учтите, что вы могли бы отобразить это в объект или массив, подобный этому:
```typescript
const expected = '400ms (a-b|)';
const values = {
  a: 'value emitted',
  b: 'another value emitted',
};

expectObservable(someStreamForTesting).toBe(expected, values);

// This would work also
const expected = '400ms (0-1|)';
const values = [
  'value emitted',
  'another value emitted'
];

expectObservable(someStreamForTesting).toBe(expected, values);
```
* '()' sync groupings: Когда несколько событий должны находиться в одном кадре синхронно, для группировки этих событий используются круглые скобки. 
* "^" точка подписки: (только для горячих наблюдаемых) показывает точку, в которой тестируемые наблюдаемые будут подписаны на горячую наблюдаемую. Это "нулевой кадр" для этой наблюдаемой, каждый кадр до ^ будет отрицательным. Отрицательное время может показаться бессмысленным, но на самом деле есть сложные случаи, когда это необходимо, обычно с использованием объектов ReplaySubjects.

Сайт для визуализации marble diagrams: https://thinkrx.io/
Сайт для взаимодействия с операторами RxJS https://rxmarbles.com/